# 01 业务可用性

## 1 系统可用度    
从可靠性的概念中可以看到可靠性是保障系统不中断运行的能力，因此在业界通常用年运行时长占比也就是系统可用度（Available）这个指标来评价产品的可靠性（业务可用性），也就是通常所说的3个9（年中断时长500分钟（8.76小时））/4个9（年中断时长52.6分钟）/5个9（年中断时长5分钟）/6个9（年中断时长30秒）等。系统可用度定义为产品在任意时刻需要和开始执行任务时，处于可工作或可使用的程度概率度量。其计算公式为：

1年 = 365天 = 8760小时

99.9 = 8760 * 0.1% = 8760 * 0.001 = 8.76小时

99.99 = 8760 * 0.0001 = 0.876小时 = 0.876 * 60 = 52.6分钟

99.999 = 8760 * 0.00001 = 0.0876小时 = 0.0876 * 60 = 5.26分钟

A = 可工作时间MUT/(可工作时间MUT+不可工作时间MDT）= 1- MDT/(MUT+MDT)

可工作时间包括不工作时间（无业务任务）、待命时间、反应时间（预热时间，例如数据加载等）、任务时间（真正工作时间）。不可工作时间包含维修时间（修复性维修+预防性维修）和延迟时间（备件延迟+管理延迟）

可用度是产品在现网客户的表现的概率统计数据，在产品的研发阶段，只能通过数学建模（例如马尔科夫模型等）进行预计，无法通过内部测试直接得到的。不过在实际实践过程中体现可用性有三个关键指标（可以通过这三个指标得出可用度）：MTTR、MTTF、MTBF

1） MTTF 即 Mean Time To Failure，平均无故障时间。指系统无故障运行的平均时间，取所有从系统开始正常运行到发生故障之间的时间段的平均值。

2） MTTR 即 Mean Time To Repair，平均修复时间，指系统从发生故障到维修结束之间的时间段的平均值。

3） MTBF 即 Mean Time Between Failure，平均失效间隔时间，指系统两次故障发生时间之间的时间段的平均值。

因此如果我们可以确定上面的这几个关键指标的话，可以通过下面的公式来评估可用性，MTBF= MTTF+MTTR  A = MTTF/MTBF*100% = MTTF/（MTTR+MTTF）*100%。但是比较遗憾的是，这几个关键指标对单纯的硬件而言是可以直接得出的（比如硬盘厂家都宣称硬盘的MTBF达到几百万小时），但是对于软件而言是没有办法直接得出的，而且也是完全没有规律性的。

2 故障容错能力
系统可用度虽好，但是在产品研发过程中无法直接进行测试验证。因此需要将可用度分解到可验证的指标上面，才能在产品研发过程中进行很好的测试与评估。

影响系统可用度的关键因素是中断时间，那么会导致中断的关键因素有两个方面，一个是系统内部发生了故障（故障属于计划外事件）导致的，另一个是系统的主动性运维（例如升级、扩容、变更、更换等等）活动（这些活动属于计划内事件）导致的。因此就从这两个方面来定义可衡量的指标。

2.1  计划外指标
       主要是对意外故障的故障管理能力的衡量，故障管理能力根据可靠性的基础定义包含故障检测/定位、隔离/恢复等。对于一个确定的系统而言，系统内潜在的故障数量是确定的，如果我们能够自动恢复的故障越多，恢复的时间越短那就意味着造成的中断次数越少以及时间越短，系统的可用度就越高。于是我们就有了如下的指标：

1） 故障自动检测率：能够自动检测/定位（硬件定位到FRU—现场可更换单元；软件定位到FMU—现场可管理单元）的故障数占系统总故障数的比例。检测/定位的含义就是能够及时（故障发生的当时）感知到发生故障的对象。故障检测/定位是故障自动恢复以及人工恢复的基础。能自动检测定位的故障未必能做到自动恢复。

2） 故障自动恢复率：能够自动恢复（业务无中断即可，故障本身可以没有修复）的故障数占到系统总故障数的比例。其含义就是通过重启、重试、倒换、迁移、备份恢复等等冗余手段来保证业务不中断。该值越高，系统的可用度越高。

3） 事故人工恢复时长：有一些故障是无法做到自动恢复的，需要人工介入恢复。对于这些故障进行人工恢复的持续时间。该值越大系统的可用性越低。

4） 故障检测时间：指的是某个故障发生后，系统多久可以感知到（检测、定位、上报），该指标是建立在故障自动检测/定位的能力基础上的。该指标是针对具体的故障而言的。可以按照单个故障或者某类故障进行定义。

5） 故障自动恢复时间：指的是某个故障被检测到后，系统多久可以对该故障进行自动恢复（重启、重试、倒换、迁移、备份恢复等手段），从而避免业务中断。该指标是针对具体的故障而言的。可以按照单个故障或者某类故障进行定义。该指标是建立在故障自动恢复的能力基础上的。针对某一个故障而言，该值加上故障检测时间就是该故障导致的业务影响时间（越短越好，越短就意味着系统可用度越高），该时间如果大于业务的容忍时间就会造成业务中断，如果小于业务容忍时间就叫做不影响/中断业务

2.2 计划内指标
       计划内的活动包含升级、补丁、扩容、更换、变更（配置、组网等）、维护保养。对于这些活动的基本要求是不中断业务（数据面业务），因此其衡量指标就是XXX活动业务中断时长（例如升级业务中断时长）。